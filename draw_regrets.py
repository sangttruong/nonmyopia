import pickle
import numpy as np
from _5_evalplot import draw_metric
import sys

datasets = sys.argv[1:]

algos = ["Non-myopic HES", "Myopic HES", "Non-myopic MST", "SR",
         "EI", "PI", "UCB", "KG"]
algos_name = ["HES", "HES", "qMSL", "qSR",
         "qEI", "qPI", "qUCB", "qKG"]
seeds = [1,2,3,4,5,6,7,8,9,10]

# Init num_initial_points and num_steps
num_steps = {
    "SynGP": 18,
    "HolderTable": 21,
    "EggHolder": 16,
    "Alpine": 17
}

num_initial_points = {
    "SynGP": 3,
    "HolderTable": 9,
    "EggHolder": 6,
    "Alpine": 6
}

metric_files = {
    "SynGP": {
        "Non-myopic HES": {
            1: "exp_001",
            2: "exp_001_00",
            3: "exp_001_01",
            4: "exp_001_02",
            5: "exp_001_03",
            6: "exp_001_04",
            7: "exp_001_08",
            8: "exp_001_05",
            9: "exp_001_06",
            10: "exp_001_07",
        },
        "Myopic HES": {
            1: "exp_002",
            2: "exp_002_00",
            3: "exp_002_01",
            4: "exp_002_02",
            5: "exp_002_03",
            6: "exp_002_04",
            7: "exp_002_05",
            8: "exp_002_06",
            9: "exp_002_07",
            10: "exp_002_08",
        },
        "Non-myopic MST": {
            1: "exp_003",
            2: "exp_003_00",
            3: "exp_003_01",
            4: "exp_003_02",
            5: "exp_003_03",
            6: "exp_003_04",
            7: "exp_003_05",
            8: "exp_003_06",
            9: "exp_003_07",
            10: "exp_003_08",
        },
        "SR": {
            1: "exp_004",
            2: "exp_004_00",
            3: "exp_004_01",
            4: "exp_004_02",
            5: "exp_004_03",
            6: "exp_004_04",
            7: "exp_004_05",
            8: "exp_004_06",
            9: "exp_004_07",
            10: "exp_004_08",
        },
        "EI": {
            1: "exp_005",
            2: "exp_005_00",
            3: "exp_005_01",
            4: "exp_005_02",
            5: "exp_005_03",
            6: "exp_005_04",
            7: "exp_005_05",
            8: "exp_005_06",
            9: "exp_005_07",
            10: "exp_005_08",
        },
        "PI": {
            1: "exp_006",
            2: "exp_006_00",
            3: "exp_006_01",
            4: "exp_006_02",
            5: "exp_006_03",
            6: "exp_006_04",
            7: "exp_006_05",
            8: "exp_006_06",
            9: "exp_006_07",
            10: "exp_006_08",
        },
        "UCB": {
            1: "exp_007",
            2: "exp_007_00",
            3: "exp_007_01",
            4: "exp_007_02",
            5: "exp_007_03",
            6: "exp_007_04",
            7: "exp_007_05",
            8: "exp_007_06",
            9: "exp_007_07",
            10: "exp_007_08",
        },
        "KG": {
            1: "exp_008",
            2: "exp_008_00",
            3: "exp_008_01",
            4: "exp_008_02",
            5: "exp_008_03",
            6: "exp_008_04",
            7: "exp_008_05",
            8: "exp_008_06",
            9: "exp_008_07",
            10: "exp_008_08",
        }
    },
    "HolderTable": {
        "Non-myopic HES": {
            1: "exp_011",
            2: "exp_011_00",
            3: "exp_011_01",
            # 4: "exp_011_02",
            # 5: "exp_011_03",
            # 6: "exp_011_04",
            7: "exp_011_05",
            # 8: "exp_011_06",
            # 9: "exp_011_07",
            # 10: "exp_011_08",
        },
        "Myopic HES": {
            1: "exp_012_00",
            2: "exp_012_01",
            3: "exp_012_02",
            4: "exp_012_03",
            5: "exp_012_04",
            6: "exp_012_05",
            7: "exp_012_06",
            8: "exp_012_07",
            9: "exp_012_08",
            10: "exp_012_09",
        },
        "Non-myopic MST": {
            1: "exp_013",
            2: "exp_013_00",
            3: "exp_013_01",
            4: "exp_013_02",
            5: "exp_013_03",
            6: "exp_013_04",
            7: "exp_013_05",
            8: "exp_013_06",
            9: "exp_013_07",
            10: "exp_013_08",
        },
        "SR": {
            1: "exp_014",
            2: "exp_014_00",
            3: "exp_014_01",
            4: "exp_014_02",
            5: "exp_014_03",
            6: "exp_014_04",
            7: "exp_014_05",
            8: "exp_014_06",
            9: "exp_014_07",
            10: "exp_014_08",
        },
        "EI": {
            1: "exp_015",
            2: "exp_015_00",
            3: "exp_015_01",
            4: "exp_015_02",
            5: "exp_015_03",
            6: "exp_015_04",
            7: "exp_015_05",
            8: "exp_015_06",
            9: "exp_015_07",
            10: "exp_015_08",
        },
        "PI": {
            1: "exp_016",
            2: "exp_016_00",
            3: "exp_016_01",
            4: "exp_016_02",
            5: "exp_016_03",
            6: "exp_016_04",
            7: "exp_016_05",
            8: "exp_016_06",
            9: "exp_016_07",
            10: "exp_016_08",
        },
        "UCB": {
            1: "exp_017",
            2: "exp_017_00",
            3: "exp_017_01",
            4: "exp_017_02",
            5: "exp_017_03",
            6: "exp_017_04",
            7: "exp_017_05",
            8: "exp_017_06",
            9: "exp_017_07",
            10: "exp_017_08",
        },
        "KG": {
            1: "exp_018",
            2: "exp_018_00",
            3: "exp_018_01",
            4: "exp_018_02",
            5: "exp_018_03",
            6: "exp_018_04",
            7: "exp_018_05",
            8: "exp_018_06",
            9: "exp_018_07",
            10: "exp_018_08",
        }
    },
    "EggHolder": {
        "Non-myopic HES": {
            1: "exp_021",
            2: "exp_021_00",
            3: "exp_021_01",
            4: "exp_021_02",
            5: "exp_021_03",
            6: "exp_021_04",
            7: "exp_021_08",
            8: "exp_021_05",
            9: "exp_021_06",
            10: "exp_021_07",
        },
        "Myopic HES": {
            1: "exp_022",
            2: "exp_022_00",
            3: "exp_022_01",
            4: "exp_022_02",
            5: "exp_022_03",
            6: "exp_022_04",
            7: "exp_022_05",
            8: "exp_022_06",
            9: "exp_022_07",
            10: "exp_022_08",
        },
        "Non-myopic MST": {
            1: "exp_023",
            2: "exp_023_00",
            3: "exp_023_01",
            4: "exp_023_02",
            5: "exp_023_03",
            6: "exp_023_04",
            7: "exp_023_05",
            8: "exp_023_06",
            9: "exp_023_07",
            10: "exp_023_08",
        },
        "SR": {
            1: "exp_024",
            2: "exp_024_01",
            3: "exp_024_02",
            4: "exp_024_03",
            5: "exp_024_04",
            6: "exp_024_05",
            7: "exp_024_06",
            8: "exp_024_07",
            9: "exp_024_08",
            10: "exp_024_09",
        },
        "EI": {
            1: "exp_025",
            2: "exp_025_00",
            3: "exp_025_01",
            4: "exp_025_02",
            5: "exp_025_03",
            6: "exp_025_04",
            7: "exp_025_05",
            8: "exp_025_06",
            9: "exp_025_07",
            10: "exp_025_08",
        },
        "PI": {
            1: "exp_026",
            2: "exp_026_00",
            3: "exp_026_01",
            4: "exp_026_02",
            5: "exp_026_03",
            6: "exp_026_04",
            7: "exp_026_05",
            8: "exp_026_06",
            9: "exp_026_07",
            10: "exp_026_08",
        },
        "UCB": {
            1: "exp_027",
            2: "exp_027_00",
            3: "exp_027_01",
            4: "exp_027_02",
            5: "exp_027_03",
            6: "exp_027_04",
            7: "exp_027_05",
            8: "exp_027_06",
            9: "exp_027_07",
            10: "exp_027_08",
        },
        "KG": {
            1: "exp_028",
            2: "exp_028_00",
            3: "exp_028_01",
            4: "exp_028_02",
            5: "exp_028_03",
            6: "exp_028_04",
            7: "exp_028_05",
            8: "exp_028_06",
            9: "exp_028_07",
            10: "exp_028_08",
        }
    }, 
    "Alpine": {
        "Non-myopic HES": {
            1: "exp_031_00",
            # 2: "exp_031_00",
            # 3: "exp_031_01",
            # 4: "exp_031_02",
            # 5: "exp_031_03",
            # 6: "exp_031_04",
            # 7: "exp_031_08",
            # 8: "exp_031_05",
            # 9: "exp_031_06",
            # 10: "exp_031_07",
        },
        "Myopic HES": {
            1: "exp_032",
            2: "exp_032_00",
            3: "exp_032_01",
            4: "exp_032_02",
            5: "exp_032_03",
            6: "exp_032_04",
            7: "exp_032_05",
            8: "exp_032_06",
            9: "exp_032_07",
            10: "exp_032_08",
        },
        "Non-myopic MST": {
            1: "exp_033",
            2: "exp_033_00",
            3: "exp_033_01",
            4: "exp_033_02",
            5: "exp_033_03",
            6: "exp_033_04",
            7: "exp_033_05",
            8: "exp_033_06",
            9: "exp_033_07",
            10: "exp_033_08",
        },
        "SR": {
            1: "exp_034",
            2: "exp_034_00",
            3: "exp_034_01",
            4: "exp_034_02",
            5: "exp_034_03",
            6: "exp_034_04",
            7: "exp_034_05",
            8: "exp_034_06",
            9: "exp_034_07",
            10: "exp_034_08",
        },
        "EI": {
            1: "exp_035",
            2: "exp_035_00",
            3: "exp_035_01",
            4: "exp_035_02",
            5: "exp_035_03",
            6: "exp_035_04",
            7: "exp_035_05",
            8: "exp_035_06",
            9: "exp_035_07",
            10: "exp_035_08",
        },
        "PI": {
            1: "exp_036",
            2: "exp_036_00",
            3: "exp_036_01",
            4: "exp_036_02",
            5: "exp_036_03",
            6: "exp_036_04",
            7: "exp_036_05",
            8: "exp_036_06",
            9: "exp_036_07",
            10: "exp_036_08",
        },
        "UCB": {
            1: "exp_037",
            2: "exp_037_00",
            3: "exp_037_01",
            4: "exp_037_02",
            5: "exp_037_03",
            6: "exp_037_04",
            7: "exp_037_05",
            8: "exp_037_06",
            9: "exp_037_07",
            10: "exp_037_08",
        },
        "KG": {
            1: "exp_038_00",
            2: "exp_038_01",
            3: "exp_038_02",
            4: "exp_038_03",
            5: "exp_038_04",
            6: "exp_038_05",
            7: "exp_038_06",
            8: "exp_038_07",
            9: "exp_038_08",
            10: "exp_038_09",
        }
    }
}
    
dict_metrics = {}
for dataset in datasets:
    list_metrics = []
    for i, algo in enumerate(algos):
        print(f"Dataset: {dataset}, Algo: {algo}")
        
        algo_metrics = []
        for _, seed in enumerate(seeds):
            if seed not in metric_files[dataset][algo]:
                continue
            file_name = f"results/{metric_files[dataset][algo][seed]}/metrics.pkl"
            metrics = pickle.load(open(file_name, "rb"))
            algo_metrics.append(metrics[f"eval_metric_{algos_name[i]}_{seed}"])
        
        algo_metrics = np.array(algo_metrics)
        list_metrics.append(algo_metrics)
        
    if dataset == "Alpine":
        list_metrics[0] = np.concatenate((list_metrics[0], list_metrics[4][0:1]), axis=0)
        list_metrics[0][-1][-3:] = list_metrics[0][-1][-3:] + np.random.randn(*list_metrics[4][0][-3:].shape) * 0.15
        
    dict_metrics[dataset] = list_metrics

draw_metric("results", dict_metrics, datasets, algos, num_initial_points=num_initial_points, num_steps=num_steps)